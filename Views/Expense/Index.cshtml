@model IEnumerable<ExpenseTracker.Models.ExpenseViewModel>
@using Microsoft.AspNetCore.Http
@{
    ViewData["Title"] = "History";
    var currentUserId = Context.Session.GetInt32("UserId");
}

<div class="container mt-5 mb-5" style="max-width: 1000px;">
    <div class="d-flex justify-content-between align-items-end mb-4 px-2">
        <div>
            <h2 class="fw-bold m-0" style="letter-spacing: -0.02em;">Expense History</h2>
            <p class="text-muted small mb-0">Tap a transaction to see the full breakdown.</p>
        </div>
        <a asp-controller="Expense" asp-action="ExpenseForm" class="btn btn-primary-minimal shadow-sm">
            <i class="bi bi-plus-lg me-1"></i> New Expense
        </a>
    </div>

    <div class="card-minimal shadow-sm border-0 overflow-hidden">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light border-bottom">
                    <tr class="small text-uppercase text-muted fw-bold" style="letter-spacing: 0.05em; font-size: 0.75rem;">
                        <th class="ps-4 py-3" style="width: 15%;">Date</th>
                        <th class="py-3" style="width: 45%;">Description</th>
                        <th class="py-3" style="width: 20%;">Role</th>
                        <th class="text-end pe-4 py-3" style="width: 20%;">Total</th>
                    </tr>
                </thead>
                <tbody class="border-top-0">
                    @foreach (var item in Model)
                    {
                        <tr class="clickable-row transition-base" 
                            data-href="@Url.Action("ExpenseDetails", "Expense", new { id = item.Id })">
                            <td class="ps-4 text-muted">
                                @item.Date.ToString("MMM dd")
                            </td>
                            <td>
                                <span class="fw-bold text-dark">@item.Name</span>
                            </td>
                            <td>
                                @if (item.CreatedByUserId == currentUserId)
                                {
                                    <span class="badge rounded-pill bg-dark-subtle text-dark border-0 px-3 py-2 fw-normal">Owner</span>
                                }
                                else
                                {
                                    <span class="badge rounded-pill bg-light text-muted border px-3 py-2 fw-normal">Participant</span>
                                }
                            </td>
                            <td class="text-end pe-4">
                                <span class="fw-bold text-primary fs-6">â‚¬@item.Amount.ToString("N2")</span>
                                <i class="bi bi-chevron-right ms-2 text-muted small opacity-50"></i>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    /* Professional Hover Effect */
    .clickable-row {
        cursor: pointer;
        transition: all 0.15s ease-in-out;
    }
    
    .clickable-row:hover {
        background-color: #f8faff !important;
        transform: scale(1.002);
    }

    .transition-base {
        transition: background-color 0.2s ease;
    }

    .badge {
        font-size: 0.75rem;
    }
</style>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const rows = document.querySelectorAll(".clickable-row");
            rows.forEach(row => {
                row.addEventListener("click", (e) => {
                    // Safety check: Don't redirect if the user clicks a button or link inside the row
                    if (e.target.closest('button') || e.target.closest('a')) return;
                    
                    const url = row.getAttribute("data-href");
                    if (url) window.location.href = url;
                });
            });
        });
    </script>
}